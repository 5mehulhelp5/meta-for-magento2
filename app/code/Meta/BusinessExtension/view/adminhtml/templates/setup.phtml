<?php
/**
 * @var Meta\BusinessExtension\Block\Adminhtml\Setup $block
 * @var $escaper \Magento\Framework\Escaper
 */
?>
<select id="store">
    <option value=""><?= $escaper->escapeHtml(__('Select store')) ?></option>
    <?php foreach ($block->getStores() as $key => $store): ?>
        <?php if ($key == 'admin'): ?>
            <?php continue; ?>
        <?php endif; ?>
        <option
            value="<?= $escaper->escapeHtmlAttr($store['store_id']) ?>"
            data-installed="<?= $escaper->escapeHtmlAttr($block->isFBEInstalled($store['store_id'])) ?>"
            data-pixel-id="<?= $escaper->escapeHtmlAttr($block->fetchPixelId($store['store_id'])) ?>"
            data-system-user-name="<?= $escaper->escapeHtmlAttr($block->getExternalBusinessId($store['store_id'])) ?>"
            data-external-business-id="<?= $escaper->escapeHtmlAttr($block->getExternalBusinessId($store['store_id'])) ?>"
        ><?= $escaper->escapeHtml(__($store['name'])) ?></option>
    <?php endforeach; ?>
</select>
<div>
    <div id="fbe-iframe">
    </div>
</div>

<script>
    window.facebookBusinessExtensionConfig = {
        popupOrigin: "https://business.facebook.com"
        , setPixelId: '<?= $escaper->escapeHtml($block->getPixelAjaxRoute()) ?>'
        , setAccessToken: '<?= $escaper->escapeHtml($block->getAccessTokenAjaxRoute()) ?>'
        , setProfilesData: '<?= $escaper->escapeHtml($block->getProfilesAjaxRoute()) ?>'
        , saveConfig: '<?= $escaper->escapeHtml($block->fetchConfigurationAjaxRoute()) ?>'
        , fbeLoginUrl: "https://business.facebook.com/fbe-iframe-get-started/?"
        , deleteConfigKeys: '<?= $escaper->escapeHtml($block->getDeleteAssetIdsAjaxRoute()) ?>'
        , appId: '<?= $escaper->escapeHtml($block->getAppId()) ?>'
        , timeZone: 'America/Los_Angeles'
        , businessVertical: 'ECOMMERCE'
        , channel: 'DEFAULT'
        , currency: '<?= $escaper->escapeHtml($block->getCurrencyCode()) ?>'
        , businessName: 'Magento'
        , debug: true
        , setAAMSettings: '<?= $escaper->escapeHtml($block->getAAMSettingsRoute()) ?>'
    };
</script>
<script>
    require([
        'Meta_BusinessExtension/js/fbe_allinone'
    ], function () {
    });
</script>
